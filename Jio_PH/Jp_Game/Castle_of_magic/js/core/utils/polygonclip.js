function lineclip(k,l,n){var g=k.length,e=bitCode(k[0],l),d=[],f,j,h,c,m;if(!n){n=[]}for(f=1;f<g;f++){j=k[f-1];h=k[f];c=m=bitCode(h,l);while(true){if(!(e|c)){d.push(j);if(c!==m){d.push(h);if(f<g-1){n.push(d);d=[]}}else{if(f===g-1){d.push(h)}}break}else{if(e&c){break}else{if(e){j=intersect(j,h,e,l);e=bitCode(j,l)}else{h=intersect(j,h,c,l);c=bitCode(h,l)}}}}e=m}if(d.length){n.push(d)}return n}function polygonclip(g,h){var j,b,d,f,e,a,c;for(b=1;b<=8;b*=2){j=[];d=g[g.length-1];f=!(bitCode(d,h)&b);for(e=0;e<g.length;e++){a=g[e];c=!(bitCode(a,h)&b);if(c!==f){j.push(intersect(d,a,b,h))}if(c){j.push(a)}d=a;f=c}g=j;if(!g.length){break}}return j}function intersect(d,c,e,f){return e&8?[d[0]+(c[0]-d[0])*(f[3]-d[1])/(c[1]-d[1]),f[3]]:e&4?[d[0]+(c[0]-d[0])*(f[1]-d[1])/(c[1]-d[1]),f[1]]:e&2?[f[2],d[1]+(c[1]-d[1])*(f[2]-d[0])/(c[0]-d[0])]:e&1?[f[0],d[1]+(c[1]-d[1])*(f[0]-d[0])/(c[0]-d[0])]:null}function bitCode(b,c){var a=0;if(b[0]<c[0]){a|=1}else{if(b[0]>c[2]){a|=2}}if(b[1]<c[1]){a|=4}else{if(b[1]>c[3]){a|=8}}return a};