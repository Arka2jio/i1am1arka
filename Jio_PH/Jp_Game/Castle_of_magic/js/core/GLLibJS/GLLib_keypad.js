(function(E,i){var a=null;var k=null;var D=-9999;var x;var c;window.s_game_keyJustPressed=-1;window.s_game_keyPressedTime=0;var f;var u;var g;var r;var C;var p;var l=-9999;var t=0;var j=null;var n=null;var m=GLKey.k_nbKey;GLLib.prototype.SetupDefaultKey=function(){this.Game_KeyClearKeyCode();n.put(32,GLKey.k_fire);n.put(83,GLKey.k_fire);n.put(68,GLKey.k_right);n.put(65,GLKey.k_left);n.put(87,GLKey.k_up);n.put(88,GLKey.k_down);n.put(46,GLLibConfig.keycodeLeftSoftkey);n.put(34,GLLibConfig.keycodeRightSoftkey);n.put(13,GLKey.k_fire);n.put(53,GLKey.k_fire);n.put(101,GLKey.k_fire);n.put(39,GLKey.k_right);n.put(54,GLKey.k_right);n.put(37,GLKey.k_left);n.put(52,GLKey.k_left);n.put(38,GLKey.k_up);n.put(50,GLKey.k_up);n.put(40,GLKey.k_down);n.put(56,GLKey.k_down);n.put(8,GLLibConfig.keycodeRightSoftkey);n.put(Canvas.DEF_SOFT_LEFT_CODE,GLLibConfig.keycodeLeftSoftkey);n.put(Canvas.DEF_SOFT_RIGHT_CODE,GLLibConfig.keycodeRightSoftkey);if(GLLibConfig.useKeyAccumulation){a=LowAPI.Gen_Array([m],0);k=LowAPI.Gen_Array([m],0)}for(var F=0;F<m;F++){j.put(F,F)}};GLLib.prototype.keyPressed=function(H){if(GLLibConfig.useBugFixMultipleKeyPressed){if(l!=H&&l!=-9999){this.keyReleased(l)}l=H}if(GLLibConfig.useKeyAccumulation){D=H;var G=this.Game_TranslateKeyCode(H);if(k==null){return}if(k[G]>0){return}if(k[G]<0){k[G]=0}if(k[G]<126){k[G]++}}else{D=H;var F=1<<this.Game_TranslateKeyCode(H);C|=F;r|=F}};GLLib.prototype.keyReleased=function(H){if(GLLibConfig.useBugFixMultipleKeyPressed){if(H==l){l=-9999}}if(GLLibConfig.useKeyAccumulation){var G=this.Game_TranslateKeyCode(H);if(k==null){return}if(k[G]>0){k[G]*=-1}}else{var F=(1<<this.Game_TranslateKeyCode(H));p|=F;r&=~F}};GLLib.prototype.UpdateKeypad=function(){if(GLLibConfig.useKeyAccumulation){c=-1;s_game_keyJustPressed=-1;for(var F=0;F<m;F++){a[F]=k[F];if(k[F]!=0){c=F;if(k[F]<0){k[F]=0}else{if(k[F]<126){if(k[F]==1){s_game_keyJustPressed=F;s_game_keyPressedTime=s_game_timeWhenFrameStart}k[F]++;if(!GLLibConfig.useSoftKeyAccumulation&&F>=GLKey.k_menuOK){k[F]*=-1}}}}}}else{f=C;u=p;g=r;C=0;p=0;s_game_keyPressedTime=s_game_timeWhenFrameStart}if(t>0){if(GLLibConfig.useFrameDT&&(t!=Integer.MAX_VALUE)){t-=s_game_frameDT}o()}};function A(){if(GLLibConfig.useKeyAccumulation){for(var F=0;F<GLKey.k_nbKey;F++){if(k[F]<0){a[F]=k[F]}}}else{}}GLLib.prototype.Game_KeyClearKeyCode=function(){n=new Hashtable(m);j=new Hashtable(m)};function y(I,K,H){Dbg("*** Game_KeySetKeyCode: ("+K+", "+H+")");var G=null;var J=K;if(I){G=n}else{G=j}var F=G.get(J);if(F!=null){G.remove(J)}G.put(J,new Integer(H))}GLLib.prototype.Game_TranslateKeyCode=function(H){if((GLLibConfig.useAbsoluteValueOfKeyCode)&&(H<0)){H*=-1}var F=H;if(j==null){return 0}var G=j.get(F);if(G==13||G==8){G=null}if(G!=null){return G}if((H==53||H==101)&&window.isBlockKey5){return H}G=n.get(F);if(G!=null){return G}return GLKey.k_dummy};function o(){if(GLLibConfig.useKeyAccumulation){if((a!=null)&&(k!=null)){for(var F=0;F<m;F++){a[F]=0;k[F]=0}}}else{f=0;u=0;g=0;r=0;C=0;p=0}}function z(F){if(GLLibConfig.useKeyAccumulation){a[F]=0;k[F]=0}else{if((g&(1<<F))!=0){f=0;u=0;g=0;r=0;C=0;p=0}}}function q(){if(GLLibConfig.useKeyAccumulation){for(var F=m;--F>=0;){if(a[F]>0){return F}}return GLKey.k_invalid}else{for(var F=m;--F>=0;){if((g&(1<<F))!=0){return F}}return GLKey.k_invalid}}function B(F){if(GLLibConfig.useKeyAccumulation){return(a[F]>0)}else{return(g&(1<<F))!=0}}function e(F){if(GLLibConfig.useKeyAccumulation){return(a[F]<=0)}else{return(g&(1<<F))==0}}function h(){if(GLLibConfig.useKeyAccumulation){for(var F=m;--F>=0;){if(a[F]==1){return F}}return GLKey.k_invalid}else{if(f==0){return GLKey.k_invalid}for(var F=m;--F>=0;){if((f&(1<<F))!=0){return F}}return GLKey.k_invalid}}function w(){if(GLLibConfig.useKeyAccumulation){for(var F=m;--F>=0;){if(a[F]<0){return F}}return GLKey.k_invalid}else{if(u==0){return GLKey.k_invalid}for(var F=m;--F>=0;){if((u&(1<<F))!=0){return F}}return GLKey.k_invalid}}function s(F){if(GLLibConfig.useKeyAccumulation){return(a[F]==1)}else{return(f&(1<<F))!=0}}function v(F){if(GLLibConfig.useKeyAccumulation){return(a[F]<0)}else{return(u&(1<<F))!=0}}function d(F){t=F}function d(){d(Integer.MAX_VALUE)}function b(){d(-1)}LowAPI.extendObject(E,{ResetKey:o,ResetAKey:z,IsAnyKeyDown:q,IsKeyDown:B,IsKeyUp:e,WasAnyKeyPressed:h,WasAnyKeyReleased:w,WasKeyPressed:s,WasKeyReleased:v,UpdateKeypad_Game:A,},true)})(window);