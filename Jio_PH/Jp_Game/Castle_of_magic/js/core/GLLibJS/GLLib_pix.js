(function(P,o){function j(){return I.apply(this,arguments)}function I(aL,an,aw,ax,av,Y,aG,az,ay,aH,af,ag,ah,W){Warn("Wrong!!!!!!!!");return an;if(!((an!=null))){Assert(false,"PFX_ProcessScaling: src cannot be null!")}var ab=an.length;var aD=0;var ac,aO;if(!(Y>=0)){Assert(false,"PFX_ProcessScaling: The module source width is negative!")}if(!(aG>=0)){Assert(false,"PFX_ProcessScaling: The module source height is negative!")}if(!(az>=0)){Assert(false,"PFX_ProcessScaling: The scale X is negative!")}if(!(ay>=0)){Assert(false,"PFX_ProcessScaling: The scale Y is negative!")}var ad=ah&(~ASprite.FLAG_FLIP_X);if((ah&ASprite.FLAG_ROT_90)!=0){ad=ah;ah=0}if(ad!=0){if((ad&ASprite.FLAG_ROT_90)!=0){u=aG;t=Y;Y=u;aG=t}an=ASprite.TransformRGB(an,Y,aG,ad);aw=ASprite.GetPixelBuffer_int(an,Y,aG)}var ai=LowAPI.Float2Int((Y*az)/100)+((Y*az)%100!=0?1:0);var aF=LowAPI.Float2Int((aG*ay)/100)+((aG*ay)%100!=0?1:0);x=ai;w=aF;if((ai<=0)||(aF<=0)){return null}var aN=LowAPI.Float2Int((Y<<GLLibConfig.math_fixedPointBase)/ai);var Z=LowAPI.Float2Int((aG<<GLLibConfig.math_fixedPointBase)/aF);var am=GetClipX(aL,false);var al=GetClipY(aL,false);var ao=GetClipWidth(aL,false);var ar=GetClipHeight(aL,false);var at=ai;var aC=0;var aB=ai;var ak=0;var aj=aF;if(!GLLibConfig.pfx_enableFrameCaching&&!GLLibConfig.pfx_enableModuleCaching){if(ax<am){ai-=(am-ax);if(ai<=0){return null}aC=am-ax;ax=am}if(av<al){aF-=(al-av);if(aF<=0){return null}ak=al-av;av=al}if((ax+ai)>(am+ao)){ai=(am+ao)-ax;if(ai<=0){return null}aB=aC+ai}if((av+aF)>(al+ar)){aF=(al+ar)-av;if(aF<=0){return null}aj=ak+aF}}var ap=LowAPI.Float2Int(aw.length/ai);if(ap<=0){Dbg("PFX_ProcessScaling Warning: Scale size is too big for the current buffer size: "+aw.length+" / "+ai+". Effect is not performed");return null}var aa=ap;var au=av;if(aH<0){var X=ap*ai;var ae;var V;if((ah&ASprite.FLAG_FLIP_X)!=0){ae=(at-aB)*aN;V=aN}else{ae=((aB-1)*aN);V=-aN}aa=LowAPI.Float2Int(aF-((aF/ap)*ap));if(aa==0){aa=ap}var aA=aa;aD=(aa*ai);au=av+aF-aa;for(var aI=aF,aK=((aI+ak)*Z);--aI>=0;){aK-=Z;aO=(((aK>>GLLibConfig.math_fixedPointBase)*Y)<<GLLibConfig.math_fixedPointBase)+ae;for(var aJ=aB;--aJ>=aC;aO+=V){if(!((aO>>GLLibConfig.math_fixedPointBase)<ab)){Assert(false,"PFX_ProcessScaling: Source image position it's outside image range!")}aw[--aD]=an[(aO>>GLLibConfig.math_fixedPointBase)]}--aa;if(aa==0){if(W){PFX_WritePixelData(aL,aw,0,ai,ax,au,ai,aA,af)}aA=ap;au-=ap;aa=ap;aD=X}}}else{var ae;var V;if((ah&ASprite.FLAG_FLIP_X)!=0){ae=((at-aC-1)*aN);V=-aN}else{ae=aC*aN;V=aN}if(!ag&&!af){af=true;aH=(((aH)&255)<<24);for(var aI=0,aK=(ak*Z);aI<aF;aI++,aK+=Z){ac=(aK>>GLLibConfig.math_fixedPointBase)*Y;for(var aJ=0,aE=ae;aJ<ai;aJ++,aE+=V){aO=ac+(aE>>GLLibConfig.math_fixedPointBase);aw[aD++]=((aH)|(an[(aO)]&16777215))}aa--;if(aa==0){if(W){PFX_WritePixelData(aL,aw,0,ai,ax,au,ai,ap,af)}au+=ap;aa=ap;aD=0}}}else{if(!ag&&af){af=true;aH=(((aH)&255)<<24);for(var aI=0,aK=(ak*Z);aI<aF;aI++,aK+=Z){ac=(aK>>GLLibConfig.math_fixedPointBase)*Y;for(var aJ=0,aE=ae;aJ<ai;aJ++,aE+=V){aO=ac+(aE>>GLLibConfig.math_fixedPointBase);var aq=an[(aO)]&16777215;if(aq!=16711935&&aq!=0){aw[aD++]=(aH|aq)}else{aw[aD++]=0}}aa--;if(aa==0){if(W){PFX_WritePixelData(aL,aw,0,ai,ax,au,ai,ap,af)}au+=ap;aa=ap;aD=0}}}else{af=true;for(var aI=0,aK=(ak*Z);aI<aF;aI++,aK+=Z){ac=(aK>>GLLibConfig.math_fixedPointBase)*Y;for(var aJ=0,aE=ae;aJ<ai;aJ++,aE+=V){aO=ac+(aE>>GLLibConfig.math_fixedPointBase);var aM=(((an[(aO)])>>24)&255);aM=(aM*aH)>>8;aM=(((aM&255)&255)<<24);aw[aD++]=((aM)|(an[(aO)]&16777215))}aa--;if(aa==0){if(W){PFX_WritePixelData(aL,aw,0,ai,ax,au,ai,ap,af)}au+=ap;aa=ap;aD=0}}}}if(W){if(aa!=ap){PFX_WritePixelData(aL,aw,0,ai,ax,au,ai,ap-aa,af)}}}return W?null:aw}window.pfx_usingScreenBuffer=GLLibConfig.pfx_useScreenBuffer&&(GLLibConfig.pfx_useFullScreenEffectBlur||GLLibConfig.pfx_useFullScreenEffectBlend||GLLibConfig.pfx_useFullScreenEffectAdditive||GLLibConfig.pfx_useFullScreenEffectSubtractive||GLLibConfig.pfx_useFullScreenEffectMultiplicative||GLLibConfig.pfx_useEffectGlow||GLLibConfig.pfx_useSpriteEffectAdditive||GLLibConfig.pfx_useSpriteEffectMultiplicative);window.pfx_useSpriteEffects=GLLibConfig.pfx_useSpriteEffectAdditive||GLLibConfig.pfx_useSpriteEffectMultiplicative||GLLibConfig.pfx_useSpriteEffectGrayscale||GLLibConfig.pfx_useSpriteEffectColorOverlay||GLLibConfig.pfx_useSpriteEffectShine||GLLibConfig.pfx_useSpriteEffectBlend||GLLibConfig.pfx_useSpriteEffectScale||GLLibConfig.pfx_useSpriteEffectRotate||GLLibConfig.pfx_useSpriteEffectFreeRotateScale||GLLibConfig.pfx_useSpriteEffectScaleAndGrayscale;var g=false;var l=0;var f=null;var n=0;var u=0;var t=0;var z=0;var y=0;var x=0;var w=0;var L=null;var B=null;var r=null;var E=0;var K=0;var H=false;var d=0;var b=0;var M=0;var F=0;var q=0;function R(V){return f[V]}function A(){l=0;q=0;d=0;b=0;M=GetScreenWidth();F=GetScreenHeight();f=LowAPI.Gen_Array([GLPixEffects.k_EFFECT_NUM],null);if(GLLibConfig.pfx_useFullScreenEffectBlur){f[GLPixEffects.k_EFFECT_FULLSCREEN_BLUR]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_FULLSCREEN_BLUR_NUM],0);a(GLPixEffects.k_EFFECT_FULLSCREEN_BLUR)}if(GLLibConfig.pfx_useFullScreenEffectBlend){f[GLPixEffects.k_EFFECT_FULLSCREEN_BLEND]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_FULLSCREEN_BLEND_NUM],0);a(GLPixEffects.k_EFFECT_FULLSCREEN_BLEND)}if(GLLibConfig.pfx_useSpriteEffectColorOverlay){f[GLPixEffects.k_EFFECT_COLOR_OVERLAY]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_COLOR_OVERLAY_NUM],0);a(GLPixEffects.k_EFFECT_COLOR_OVERLAY)}if(GLLibConfig.pfx_useSpriteEffectGrayscale){f[GLPixEffects.k_EFFECT_GRAYSCALE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_GRAYSCALE_NUM],0);a(GLPixEffects.k_EFFECT_GRAYSCALE)}if(GLLibConfig.pfx_useSpriteEffectShine){f[GLPixEffects.k_EFFECT_SHINE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_SHINE_NUM],0);a(GLPixEffects.k_EFFECT_SHINE)}if(GLLibConfig.pfx_useEffectGlow){f[GLPixEffects.k_EFFECT_GLOW]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_GLOW_NUM],0);a(GLPixEffects.k_EFFECT_GLOW)}if(GLLibConfig.pfx_useSpriteEffectBlend){f[GLPixEffects.k_EFFECT_BLEND]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_BLEND_NUM],0);a(GLPixEffects.k_EFFECT_BLEND)}if(GLLibConfig.pfx_useSpriteEffectScale){f[GLPixEffects.k_EFFECT_SCALE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_SCALE_NUM],0);a(GLPixEffects.k_EFFECT_SCALE)}if(GLLibConfig.pfx_useSpriteEffectFreeRotateScale){f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_NUM],0);a(GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE)}if(GLLibConfig.pfx_useSpriteEffectScaleAndGrayscale){f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_NUM],0);a(GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE)}if(GLLibConfig.pfx_useSpriteEffectRotate){f[GLPixEffects.k_EFFECT_ROTATE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_ROTATE_NUM],0);a(GLPixEffects.k_EFFECT_ROTATE)}if(GLLibConfig.pfx_useSpriteEffectStencil){f[GLPixEffects.k_EFFECT_STENCIL]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_STENCIL_NUM],0);a(GLPixEffects.k_EFFECT_STENCIL)}if(GLLibConfig.pfx_useSpriteEffectPerspective){f[GLPixEffects.k_EFFECT_PERSPECTIVE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_PERSPECTIVE_NUM],0);a(GLPixEffects.k_EFFECT_PERSPECTIVE)}if(GLLibConfig.pfx_useSpriteEffectAdditive){f[GLPixEffects.k_EFFECT_ADDITIVE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_ADDITIVE_NUM],0);a(GLPixEffects.k_EFFECT_ADDITIVE)}if(GLLibConfig.pfx_useSpriteEffectMultiplicative){f[GLPixEffects.k_EFFECT_MULTIPLICATIVE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_MULTIPLICATIVE_NUM],0);a(GLPixEffects.k_EFFECT_MULTIPLICATIVE)}if(GLLibConfig.pfx_useSpriteEffectOverlay){f[GLPixEffects.k_EFFECT_OVERLAY]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_OVERLAY_NUM],0);a(GLPixEffects.k_EFFECT_OVERLAY)}if(GLLibConfig.pfx_useSpriteEffectColorDodge){f[GLPixEffects.k_EFFECT_COLORDODGE]=LowAPI.Gen_Array([GLPixEffects.k_PARAM_COLORDODGE_NUM],0);a(GLPixEffects.k_EFFECT_COLORDODGE)}if(pfx_usingScreenBuffer){if(GLLibConfig.landscape_useRotatedModules){var V=M;M=F;F=V}L=Image.createImage(M,F);B=L.getGraphics()}E=0;g=true}function a(V){switch(V){case GLPixEffects.k_EFFECT_FULLSCREEN_BLUR:if(GLLibConfig.pfx_useFullScreenEffectBlur){f[GLPixEffects.k_EFFECT_FULLSCREEN_BLUR][GLPixEffects.k_PARAM_FULLSCREEN_BLUR_AMOUNT_INC_RATE]=GLPixEffects.k_DEFAULT_FULLSCREEN_BLUR_AMOUNT_INC}break;case GLPixEffects.k_EFFECT_FULLSCREEN_BLEND:if(GLLibConfig.pfx_useFullScreenEffectBlend){f[GLPixEffects.k_EFFECT_FULLSCREEN_BLEND][GLPixEffects.k_PARAM_FULLSCREEN_BLEND_AMOUNT_INC_RATE]=GLPixEffects.k_DEFAULT_FULLSCREEN_BLEND_AMOUNT_INC}break;case GLPixEffects.k_EFFECT_GRAYSCALE:if(GLLibConfig.pfx_useSpriteEffectGrayscale){f[GLPixEffects.k_EFFECT_GRAYSCALE][GLPixEffects.k_PARAM_GRAYSCALE_ALPHA]=-1;f[GLPixEffects.k_EFFECT_GRAYSCALE][GLPixEffects.k_PARAM_GRAYSCALE_ALPHA_PROCESSING]=GLPixEffects.k_ALPHA_PROCESSING_AUTO;f[GLPixEffects.k_EFFECT_GRAYSCALE][GLPixEffects.k_PARAM_GRAYSCALE_SATURATION]=0}break;case GLPixEffects.k_EFFECT_COLOR_OVERLAY:if(GLLibConfig.pfx_useSpriteEffectColorOverlay){f[GLPixEffects.k_EFFECT_COLOR_OVERLAY][GLPixEffects.k_PARAM_COLOR_OVERLAY_COLOR]=4294967295}break;case GLPixEffects.k_EFFECT_SHINE:if(GLLibConfig.pfx_useSpriteEffectShine){f[GLPixEffects.k_EFFECT_SHINE][GLPixEffects.k_PARAM_SHINE_POSX]=0;f[GLPixEffects.k_EFFECT_SHINE][GLPixEffects.k_PARAM_SHINE_WIDTH]=40;f[GLPixEffects.k_EFFECT_SHINE][GLPixEffects.k_PARAM_SHINE_COLOR]=16777215;f[GLPixEffects.k_EFFECT_SHINE][GLPixEffects.k_PARAM_SHINE_DISTANCE_ABSOLUTE]=0;f[GLPixEffects.k_EFFECT_SHINE][GLPixEffects.k_PARAM_SHINE_MAX_VALUE_SHIFT]=8;f[GLPixEffects.k_EFFECT_SHINE][GLPixEffects.k_PARAM_SHINE_ALPHA_PROCESSING]=GLPixEffects.k_ALPHA_PROCESSING_AUTO}break;case GLPixEffects.k_EFFECT_GLOW:if(GLLibConfig.pfx_useEffectGlow){f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_THRESHOLD_RED]=GLPixEffects.k_DEFAULT_GLOW_THRESHOLD_RED;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_THRESHOLD_GREEN]=GLPixEffects.k_DEFAULT_GLOW_THRESHOLD_GREEN;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_THRESHOLD_BLUE]=GLPixEffects.k_DEFAULT_GLOW_THRESHOLD_BLUE;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_THRESHOLD_TYPE]=GLPixEffects.k_DEFAULT_GLOW_THRESHOLD_TYPE;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_WIDTH_MARGIN]=GLPixEffects.k_DEFAULT_GLOW_WIDTH_MARGIN;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_HEIGHT_MARGIN]=GLPixEffects.k_DEFAULT_GLOW_HEIGHT_MARGIN;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_PERIOD1]=Math_IntToFixedPoint(GLPixEffects.k_DEFAULT_GLOW_PERIOD1);f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_PERIOD2]=Math_IntToFixedPoint(GLPixEffects.k_DEFAULT_GLOW_PERIOD2);f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_HSPREAD_MIN]=GLPixEffects.k_DEFAULT_GLOW_HSPREAD_MIN;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_VSPREAD_MIN]=GLPixEffects.k_DEFAULT_GLOW_VSPREAD_MIN;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_INTENSITY_MIN]=GLPixEffects.k_DEFAULT_GLOW_INTENSITY_MIN;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_HSPREAD_MAX]=GLPixEffects.k_DEFAULT_GLOW_HSPREAD_MAX;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_VSPREAD_MAX]=GLPixEffects.k_DEFAULT_GLOW_VSPREAD_MAX;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_INTENSITY_MAX]=GLPixEffects.k_DEFAULT_GLOW_INTENSITY_MAX;f[GLPixEffects.k_EFFECT_GLOW][GLPixEffects.k_PARAM_GLOW_INTENSITY_DIVISOR]=GLPixEffects.k_DEFAULT_GLOW_INTENSITY_DIVISOR}break;case GLPixEffects.k_EFFECT_BLEND:if(GLLibConfig.pfx_useSpriteEffectBlend){f[GLPixEffects.k_EFFECT_BLEND][GLPixEffects.k_PARAM_BLEND_AMOUNT]=255;f[GLPixEffects.k_EFFECT_BLEND][GLPixEffects.k_PARAM_BLEND_ALPHA_PROCESSING]=GLPixEffects.k_ALPHA_PROCESSING_AUTO}break;case GLPixEffects.k_EFFECT_SCALE:if(GLLibConfig.pfx_useSpriteEffectScale){f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_PERCENT]=100;f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_ALPHA]=-1;f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_ALPHA_PROCESSING]=GLPixEffects.k_ALPHA_PROCESSING_AUTO;f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_PERCENT_X]=100;f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_PERCENT_Y]=100;f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_SCALE_POSITION]=0;f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_ROTATE_ANGLE]=0}break;case GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE:if(GLLibConfig.pfx_useSpriteEffectScale){f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_PERCENT]=100;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_ALPHA]=-1;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_ALPHA_PROCESSING]=GLPixEffects.k_ALPHA_PROCESSING_AUTO;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_PERCENT_X]=100;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_PERCENT_Y]=100;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_SCALE_POSITION]=0;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_ANGLE]=0;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_ANCHOR_X]=0;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_ANCHOR_Y]=0;f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_SATURATION]=255}break;case GLPixEffects.k_EFFECT_ROTATE:if(GLLibConfig.pfx_useSpriteEffectScale){f[GLPixEffects.k_EFFECT_ROTATE][GLPixEffects.k_PARAM_ROTATE_ANGLE]=0}break;case GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE:if(GLLibConfig.pfx_useSpriteEffectScaleAndGrayscale){f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_PERCENT]=100;f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_ALPHA]=-1;f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_ALPHA_PROCESSING]=GLPixEffects.k_ALPHA_PROCESSING_AUTO;f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_PERCENT_X]=100;f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_PERCENT_Y]=100;f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_SATURATION]=0;f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_SCALE_POSITION]=0}break;case GLPixEffects.k_EFFECT_STENCIL:if(GLLibConfig.pfx_useSpriteEffectStencil){f[GLPixEffects.k_EFFECT_STENCIL][GLPixEffects.k_PARAM_STENCIL_COLOR]=4278190080}break;case GLPixEffects.k_EFFECT_PERSPECTIVE:if(GLLibConfig.pfx_useSpriteEffectPerspective){f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_TYPE]=GLPixEffects.k_PERSPECTIVE_NONE;f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P2_POS_X]=-1;f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P2_POS_Y]=-1;f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P3_POS_X]=-1;f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P3_POS_Y]=-1;f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P4_POS_X]=-1;f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P4_POS_Y]=-1}break;case GLPixEffects.k_EFFECT_ADDITIVE:if(GLLibConfig.pfx_useSpriteEffectAdditive){f[GLPixEffects.k_EFFECT_ADDITIVE][GLPixEffects.k_PARAM_ADDITIVE_BLEND_AMOUNT]=255}break;case GLPixEffects.k_EFFECT_MULTIPLICATIVE:if(GLLibConfig.pfx_useSpriteEffectMultiplicative){f[GLPixEffects.k_EFFECT_MULTIPLICATIVE][GLPixEffects.k_PARAM_MULTIPLICATIVE_BLEND_AMOUNT]=255}break;case GLPixEffects.k_EFFECT_OVERLAY:if(GLLibConfig.pfx_useSpriteEffectOverlay){f[GLPixEffects.k_EFFECT_OVERLAY][GLPixEffects.k_PARAM_OVERLAY_BLEND_AMOUNT]=255;f[GLPixEffects.k_EFFECT_OVERLAY][GLPixEffects.k_PARAM_OVERLAY_MODE]=GLPixEffects.k_OVERLAY_MODE_MASK_OVER_BG}break;case GLPixEffects.k_EFFECT_COLORDODGE:if(GLLibConfig.pfx_useSpriteEffectColorDodge){f[GLPixEffects.k_EFFECT_COLORDODGE][GLPixEffects.k_PARAM_COLORDODGE_BLEND_AMOUNT]=255}break;case GLPixEffects.k_EFFECT_FULLSCREEN_ADDITIVE:case GLPixEffects.k_EFFECT_FULLSCREEN_SUBTRACTIVE:case GLPixEffects.k_EFFECT_FULLSCREEN_MULTIPLICATIVE:break}}function C(V,W){if(arguments.length<2){W=false}l|=(1<<V);if(!pfx_usingScreenBuffer&&!GLLibConfig.pfx_useBlendToCustomBuffer&&!GLLibConfig.sprite_allowPixelArrayGraphics){if(((1<<V)&GLPixEffects.k_EFFECTS_THAT_NEED_SCREEN_BUFFER_MASK)!=0){Dbg("PFX_EnableEffect: Setting a full-screen effect when neither NokiaUI is available nor a full-screen buffer!");l&=~GLPixEffects.k_EFFECTS_THAT_NEED_SCREEN_BUFFER_MASK}}if(((1<<V)&GLPixEffects.k_EFFECTS_IN_FULL_SCREEN_MASK)!=0){PFX_EnableScreenBuffer(V)}if((V==GLPixEffects.k_EFFECT_STENCIL)&&!GLLibConfig.pfx_useSpriteEffectStencil){Dbg("PFX_EnableEffect: Stencil Effect is not enabled, you must set pfx_useSpriteEffectStencil to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_SCALE)&&!GLLibConfig.pfx_useSpriteEffectScale){Dbg("PFX_EnableEffect: Scale Effect is not enabled, you must set pfx_useSpriteEffectScale to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_BLEND)&&!GLLibConfig.pfx_useSpriteEffectBlend){Dbg("PFX_EnableEffect: Blend Effect is not enabled, you must set pfx_useSpriteEffectBlend to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_GRAYSCALE)&&!GLLibConfig.pfx_useSpriteEffectGrayscale){Dbg("PFX_EnableEffect: Grayscale Effect is not enabled, you must set pfx_useSpriteEffectGrayscale to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE)&&!GLLibConfig.pfx_useSpriteEffectScaleAndGrayscale){Dbg("PFX_EnableEffect: Scale And Grayscale Effect is not enabled, you must set pfx_useSpriteEffectScaleAndGrayscale to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_SHINE)&&!GLLibConfig.pfx_useSpriteEffectShine){Dbg("PFX_EnableEffect: Shine Effect is not enabled, you must set pfx_useSpriteEffectShine to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_ADDITIVE)&&!GLLibConfig.pfx_useSpriteEffectAdditive){Dbg("PFX_EnableEffect: Additive Effect is not enabled, you must set pfx_useSpriteEffectAdditive to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_MULTIPLICATIVE)&&!GLLibConfig.pfx_useSpriteEffectMultiplicative){Dbg("PFX_EnableEffect: Multiplicative Effect is not enabled, you must set pfx_useSpriteEffectMultiplicative to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_OVERLAY)&&!GLLibConfig.pfx_useSpriteEffectOverlay){Dbg("PFX_EnableEffect: Overlay Effect is not enabled, you must set pfx_useSpriteEffectOverlay to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_COLORDODGE)&&!GLLibConfig.pfx_useSpriteEffectColorDodge){Dbg("PFX_EnableEffect: Color Dodge Effect is not enabled, you must set pfx_useSpriteEffectColorDodge to TRUE!")}else{if((V==GLPixEffects.k_EFFECT_PERSPECTIVE)&&!GLLibConfig.pfx_useSpriteEffectPerspective){Dbg("PFX_EnableEffect: Perspective Effect is not enabled, you must set pfx_useSpriteEffectPerspective to TRUE!")}}}}}}}}}}}if(W){a(V)}}function O(V,W){if(arguments.length<2){W=false}if((GLLibConfig.pfx_useFullScreenEffectBlur)&&(V==GLPixEffects.k_EFFECT_FULLSCREEN_BLUR)&&(f[GLPixEffects.k_EFFECT_FULLSCREEN_BLUR][GLPixEffects.k_PARAM_FULLSCREEN_BLUR_CURRENT_STATE]!=GLPixEffects.k_BLUR_STATE_FINISHED)){if(f[GLPixEffects.k_EFFECT_FULLSCREEN_BLUR][GLPixEffects.k_PARAM_FULLSCREEN_BLUR_CURRENT_STATE]<GLPixEffects.k_BLUR_STATE_OUT){f[GLPixEffects.k_EFFECT_FULLSCREEN_BLUR][GLPixEffects.k_PARAM_FULLSCREEN_BLUR_CURRENT_STATE]=GLPixEffects.k_BLUR_STATE_OUT}}else{l&=~(1<<V);if(((1<<V)&GLPixEffects.k_EFFECTS_IN_FULL_SCREEN_MASK)!=0){PFX_DisableScreenBuffer(V)}if(GLLibConfig.pfx_useFullScreenEffectBlend){if(V==GLPixEffects.k_EFFECT_FULLSCREEN_BLEND){H=false}}}if(W){a(V)}}function m(V){return(l&(1<<V))!=0}function U(){return l&GLPixEffects.k_EFFECTS_SPRITE_MASK}function T(X,V,W){if((0==0)){if(!((X>=0)&&(X<GLPixEffects.k_EFFECT_NUM))){Assert(false,"PFX_SetParam: Invalid effect ID: "+X)}if(!(f!=null)){Assert(false,"PFX_SetParam: Parameters are null, did you call PFX_Init?")}if(!(f[X]!=null)){Assert(false,"PFX_SetParam: Parameters for this effect are null, did you call PFX_Init? Did you enable this effect in GLLibConfig?")}}f[X][V]=W}function e(W,V){return f[W][V]}function p(V,Z,W,X){if(GLLibConfig.pfx_useFullScreenEffectBlur||GLLibConfig.pfx_useFullScreenEffectBlend){d=V;b=Z;M=W;F=X;if(GLLibConfig.landscape_useRotatedModules){var Y=d;d=GetGraphicsHeight()-b-F;b=Y;Y=M;M=F;F=Y}}else{Dbg("PFX_SetFullScreenEffectWindow: No full-screen pixel effects are enabled!")}}function N(){return e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT)}function i(){var V=e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT);if(V!=100){return V}return e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT_X)}function h(){var V=e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT);if(V!=100){return V}return e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT_Y)}function D(){return e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_SCALE_POSITION)!=0}function v(){return e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_ROTATE_ANGLE)}function G(V){T(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT,V);T(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT_X,V);T(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_PERCENT_Y,V)}function c(V,W){if(W==GLPixEffects.k_ALPHA_PROCESSING_BINARY){return false}else{if(W==GLPixEffects.k_ALPHA_PROCESSING_MULTI){return true}}return V}function Q(){if(arguments){switch(arguments.length){case 9:return J.apply(this,arguments);case 10:if(typeof arguments[9]=="number"){return s.apply(this,arguments)}else{if(arguments[1] instanceof Image){return k.apply(this,arguments)}else{return S.apply(this,arguments)}}}}throw new Error("InvalidArguments")}function k(ab,Y,ae,ad,af,Z,V,aa,W,ac){if(!(Y!=null)){Assert(false,"PFX_ProcessSpriteEffects: img parameter is null!")}var X=ASprite.GetPixelBuffer_int(null);GetRGB(Y,X,0,af,0,0,af,Z);return Q(ab,X,ae,ad,af,Z,V,aa,W,ac)}function s(ab,Y,ad,ac,ae,Z,V,aa,W,X){if(!(Y!=null)){Assert(false,"PFX_ProcessSpriteEffects: img parameter is null!")}Err("PFX_ProcessSpriteEffects: No way to extract RGB data from image!");return null}function J(aa,V,ac,ab,ad,Y,W,Z,X){return Q(aa,V,ac,ab,ad,Y,W,Z,X,true)}function S(am,X,ac,aa,ad,al,W,ak,ah,ab){n=ak;u=ad;t=al;z=ac;y=aa;if((l&GLPixEffects.k_EFFECTS_SPRITE_NEED_TRANSFORM_MASK)!=0){if((W&ASprite.FLAG_ROT_90)!=0){u=al;t=ad;ad=u;al=t}X=ASprite.TransformRGB(X,ad,al,W)}x=ad;w=al;var aj=ASprite.GetPixelBuffer_int(X,ad,al);if((l&(1<<GLPixEffects.k_EFFECT_SCALE))!=0){if(GLLibConfig.pfx_useSpriteEffectScale){ah=c(ah,f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_ALPHA_PROCESSING]);var an=e(GLPixEffects.k_EFFECT_SCALE,GLPixEffects.k_PARAM_SCALE_ROTATE_ANGLE);if(an%Math_Angle360!=0){ak=true;aj=PFX_ProcessRotating(am,X,aj,ac,aa,ad,al,an,W,false);X=aj;aj=ASprite.GetPixelBuffer_int(aj,ad,al);ac=z;aa=y;ad=x;al=w;W&=~W}var af;var ae;if(GLLibConfig.landscape_useRotatedModules){af=h();ae=i()}else{af=i();ae=h()}return j(am,X,aj,ac,aa,ad,al,af,ae,f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_ALPHA],ak,ah,W,ab)}}else{if((l&(1<<GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE))!=0){if(GLLibConfig.pfx_useSpriteEffectFreeRotateScale){ah=c(ah,f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_ALPHA_PROCESSING]);var an=PFX_FreeRotateScale_GetAngle();var V=f[GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE][GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_SATURATION];if(V!=255){aj=PFX_ProcessGrayscaleEffect(X,aj,ad*al,V,-1,ak,ah);X=aj;aj=ASprite.GetPixelBuffer_int(aj,ad,al)}if(an%s_math_F_1!=0){ak=true;aj=PFX_ProcessRotating(am,X,aj,ac,aa,ad,al,an,W,false);X=aj;aj=ASprite.GetPixelBuffer_int(aj,ad,al);ac=z;aa=y;ad=x;al=w;W&=~W}var af;var ae;if(GLLibConfig.landscape_useRotatedModules){af=PFX_FreeRotateScale_GetScaleY();ae=PFX_FreeRotateScale_GetScaleX()}else{af=PFX_FreeRotateScale_GetScaleX();ae=PFX_FreeRotateScale_GetScaleY()}if(af==100&&ae==100){return X}return j(am,X,aj,ac,aa,ad,al,af,ae,f[GLPixEffects.k_EFFECT_SCALE][GLPixEffects.k_PARAM_SCALE_ALPHA],ak,ah,W,ab)}}else{if((l&(1<<GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE))!=0){if(GLLibConfig.pfx_useSpriteEffectScaleAndGrayscale){ah=c(ah,f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_ALPHA_PROCESSING]);aj=PFX_ProcessGrayscaleEffect(X,aj,ad*al,f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_SATURATION],-1,ak,ah);var Y=ASprite.GetPixelBuffer_int(aj,ad,al);return j(am,aj,Y,ac,aa,ad,al,PFX_ScaleAndGrayscale_GetScaleX(),PFX_ScaleAndGrayscale_GetScaleY(),f[GLPixEffects.k_EFFECT_SCALE_AND_GRAYSCALE][GLPixEffects.k_PARAM_SCALE_AND_GRAYSCALE_ALPHA],ak,ah,W,ab)}}else{if((l&(1<<GLPixEffects.k_EFFECT_ROTATE))!=0){if(GLLibConfig.pfx_useSpriteEffectRotate){return PFX_ProcessRotating(am,X,aj,ac,aa,ad,al,PFX_Rotate_GetAngle(),W,ab)}}else{if((l&(1<<GLPixEffects.k_EFFECT_BLEND))!=0){if(GLLibConfig.pfx_useSpriteEffectBlend){ah=c(ah,f[GLPixEffects.k_EFFECT_BLEND][GLPixEffects.k_PARAM_BLEND_ALPHA_PROCESSING]);return PFX_ProcessBlend(X,aj,ad*al,f[GLPixEffects.k_EFFECT_BLEND][GLPixEffects.k_PARAM_BLEND_AMOUNT],ak,ah)}}else{if((l&(1<<GLPixEffects.k_EFFECT_GRAYSCALE))!=0){if(GLLibConfig.pfx_useSpriteEffectGrayscale){ah=c(ah,f[GLPixEffects.k_EFFECT_GRAYSCALE][GLPixEffects.k_PARAM_GRAYSCALE_ALPHA_PROCESSING]);return PFX_ProcessGrayscaleEffect(X,aj,ad*al,f[GLPixEffects.k_EFFECT_GRAYSCALE][GLPixEffects.k_PARAM_GRAYSCALE_SATURATION],f[GLPixEffects.k_EFFECT_GRAYSCALE][GLPixEffects.k_PARAM_GRAYSCALE_ALPHA],ak,ah)}}else{if((l&(1<<GLPixEffects.k_EFFECT_SHINE))!=0){if(GLLibConfig.pfx_useSpriteEffectShine){ah=c(ah,f[GLPixEffects.k_EFFECT_SHINE][GLPixEffects.k_PARAM_SHINE_ALPHA_PROCESSING]);return PFX_ProcessShineEffect(am,X,aj,ac,aa,ad,al,W,ah)}}else{if((l&(1<<GLPixEffects.k_EFFECT_ADDITIVE))!=0){if(GLLibConfig.pfx_useSpriteEffectAdditive){var ai=l&((1<<GLPixEffects.k_EFFECT_ADDITIVE)|(1<<GLPixEffects.k_EFFECT_MULTIPLICATIVE)|(1<<GLPixEffects.k_EFFECT_OVERLAY)|(1<<GLPixEffects.k_EFFECT_COLORDODGE));var Z=f[GLPixEffects.k_EFFECT_ADDITIVE][GLPixEffects.k_PARAM_ADDITIVE_BLEND_AMOUNT];return PFX_ProcessPixelEffect(am,X,aj,ac,aa,ad,al,W,ai,Z,0,true)}}else{if((l&(1<<GLPixEffects.k_EFFECT_MULTIPLICATIVE))!=0){if(GLLibConfig.pfx_useSpriteEffectMultiplicative){var ai=l&((1<<GLPixEffects.k_EFFECT_ADDITIVE)|(1<<GLPixEffects.k_EFFECT_MULTIPLICATIVE)|(1<<GLPixEffects.k_EFFECT_OVERLAY)|(1<<GLPixEffects.k_EFFECT_COLORDODGE));var Z=f[GLPixEffects.k_EFFECT_MULTIPLICATIVE][GLPixEffects.k_PARAM_MULTIPLICATIVE_BLEND_AMOUNT];return PFX_ProcessPixelEffect(am,X,aj,ac,aa,ad,al,W,ai,Z,0,true)}}else{if((l&(1<<GLPixEffects.k_EFFECT_OVERLAY))!=0){if(GLLibConfig.pfx_useSpriteEffectOverlay){var ai=l&((1<<GLPixEffects.k_EFFECT_ADDITIVE)|(1<<GLPixEffects.k_EFFECT_MULTIPLICATIVE)|(1<<GLPixEffects.k_EFFECT_OVERLAY)|(1<<GLPixEffects.k_EFFECT_COLORDODGE));var Z=f[GLPixEffects.k_EFFECT_OVERLAY][GLPixEffects.k_PARAM_OVERLAY_BLEND_AMOUNT];var ag=f[GLPixEffects.k_EFFECT_OVERLAY][GLPixEffects.k_PARAM_OVERLAY_MODE];return PFX_ProcessPixelEffect(am,X,aj,ac,aa,ad,al,W,ai,Z,ag,true)}}else{if((l&(1<<GLPixEffects.k_EFFECT_COLORDODGE))!=0){if(GLLibConfig.pfx_useSpriteEffectColorDodge){var ai=l&((1<<GLPixEffects.k_EFFECT_ADDITIVE)|(1<<GLPixEffects.k_EFFECT_MULTIPLICATIVE)|(1<<GLPixEffects.k_EFFECT_OVERLAY)|(1<<GLPixEffects.k_EFFECT_COLORDODGE));var Z=f[GLPixEffects.k_EFFECT_COLORDODGE][GLPixEffects.k_PARAM_COLORDODGE_BLEND_AMOUNT];return PFX_ProcessPixelEffect(am,X,aj,ac,aa,ad,al,W,ai,Z,0,true)}}else{if((l&(1<<GLPixEffects.k_EFFECT_STENCIL))!=0){if(GLLibConfig.pfx_useSpriteEffectStencil){return PFX_ProcessStencilEffect(am,X,aj,ad*al,f[GLPixEffects.k_EFFECT_STENCIL][GLPixEffects.k_PARAM_STENCIL_COLOR],ak,ah)}}else{if((l&(1<<GLPixEffects.k_EFFECT_PERSPECTIVE))!=0){if(GLLibConfig.pfx_useSpriteEffectPerspective){if(f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_TYPE]==GLPixEffects.k_PERSPECTIVE_X){Warn("PFX_ProcessXPerspective not implemented yet!")}else{if(f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_TYPE]==GLPixEffects.k_PERSPECTIVE_Y){return PFX_ProcessYPerspective(am,X,aj,ac,aa,ad,al,f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P2_POS_X],f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P2_POS_Y],f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P3_POS_Y],f[GLPixEffects.k_EFFECT_PERSPECTIVE][GLPixEffects.k_PARAM_PERSPECTIVE_P4_POS_Y],W)}else{Warn("PFX_ProcessSpriteEffects Perspective transformation used but type not set!")}}}}}}}}}}}}}}}}return null}LowAPI.extendObject(P,{PFX_Init:A,PFX_SetFullScreenEffectWindow:p,},true)})(window);